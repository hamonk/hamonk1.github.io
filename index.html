<!DOCTYPE html>
<html>

<head>

<link rel="stylesheet" href="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.css" />
<script src="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>

</head>

<body>
      <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
    </style>

<div id="map"></div>
<script>

$(document).ready(function() {

  var mapquestUrl = 'http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png';
  var subDomains = ['otile1', 'otile2', 'otile3', 'otile4'];
  var mapquestAttrib = '<a href="http://open.mapquest.com" target="_blank">MapQuest</a>, <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a>';

    var _markersGroup = undefined;
    var _map = undefined;

    var _setupMap = function(mapDiv) {
      var options = {
        /*ID of element on the page where you want the map added*/
        zoom: 3,
        /*initial zoom level of the map*/
        latLng: {
          lat: 53.690833,
          lng: 18.140555
        },
        /*center of map in latitude/longitude */
        mtype: 'osm',
        bestFitMargin: 0,
        /*margin offset from the map viewport when applying a bestfit on shapes*/
        zoomOnDoubleClick: true, /*zoom in when double-clicking on map*/
        zoomControl: true, /*don't show the zoom control, it will be added later*/
        scrollWheelZoom: true,

        /*dragging: false,
        keyboard: false,
        touchZoom: false,
        doubleClickZoom: false,
        boxZoom: false,*/
      };

      _map = L.map(mapDiv[0], options).setView([45.69125, -110.17883], 4);

      var mapquest = new L.TileLayer(mapquestUrl, {
        maxZoom: 18,
        attribution: mapquestAttrib,
        subdomains: subDomains
      }).addTo(_map);

      //L.control.zoom({position: 'bottomleft'}).addTo(_map);

      _markersGroup = L.layerGroup().addTo(_map);

      $.getJSON("json/ref_content.json", function(json) {

        var jsonData = json['onds'];
        var serie = [];

        for (var i in jsonData) {
          //console.log(jsonData[i]);
          var origin = [jsonData[i]["origin"]["location"]["latitude"],jsonData[i]["origin"]["location"]["longitude"]];
          var destination = [jsonData[i]["destination"]["location"]["latitude"],jsonData[i]["destination"]["location"]["longitude"]];
          
          serie.push([origin,destination])
        }

      //console.log(serie)

      var polygon = L.multiPolygon(serie,{weight:1,color:'#6699FF',opacity:0.2}).addTo(_map);

      });


      //var a = [[40.69125, -74.17883],[33.942536, -118.408075]];
      //var b = [[41.283460, -70.099460],[39.739150, -104.984700]];

      

      //var polygon = L.polygon().addTo(_map);


      //_map.on('zoomend', this.onZoomChanged);
      //_map.on('click', this.onMapClicked);
      //_map.on('dblclick', this.onMapDoubleClicked);
      //_map.on('moveend', this.onMapMoveEnd);
    };

    var _showPins = function(collection) {
      var map = this._map;
      var first = true;
      var first_pin = undefined;

      collection.each(function(pin) {
        var coords = pin.toCoords();
        var name = pin.get('name');
        var custom_marker;

        if (first) {
          custom_marker = L.AwesomeMarkers.icon({
            prefix: 'fa',
            icon: 'compass',
            markerColor: 'red',
          });
        } else {
          custom_marker = L.AwesomeMarkers.icon({
            prefix: 'fa',
            icon: 'binoculars',
            markerColor: 'blue',
          });
        }

        var options = {
          title: name,
          alt: name,
          icon: custom_marker,
        };

        var marker = L.marker(coords, options);
        if (first) {
          first_pin = marker;
          first = false;          
        } else {
          marker.addTo(map);          
        }

        marker.bindPopup($('<span/>').text(name)[0]);
      });

      if (first_pin != undefined) {
        first_pin.addTo(map);
      }

      var bounds = L.latLngBounds(collection.map(function(pin) { return pin.toCoords(); }));
      map.fitBounds(bounds, {padding: [20, 20], maxZoom: 8});
    };

    // Bootstrap
    var $el = $("#map");
    _setupMap($el);
    /*if (this.collection) {
      _showPins(this.collection);
    }*/
  });
</script>

</body>


</html>
